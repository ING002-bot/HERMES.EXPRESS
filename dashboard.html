<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HERMES - Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <div class="contenedor">
        <!-- Barra lateral -->
        <nav class="barra-lateral">
            <div class="logo">
                <h2>HERMES EXPRESS LOGISTIC</h2>
            </div>
            
            <ul class="menu">
                <li><a href="#inicio" class="activo" onclick="mostrarSeccion('inicio')">
                    <span class="icono">üè†</span>Inicio
                </a></li>
                <li><a href="#paquetes" onclick="mostrarSeccion('paquetes')">
                    <span class="icono">üì¶</span>Paquetes
                </a></li>
                <li><a href="#rutas" onclick="mostrarSeccion('rutas')">
                    <span class="icono">üó∫Ô∏è</span>Rutas
                </a></li>
                <li><a href="#vehiculos" onclick="mostrarSeccion('vehiculos')">
                    <span class="icono">üöõ</span>Veh√≠culos
                </a></li>
                <li><a href="#reportes" onclick="mostrarSeccion('reportes')">
                    <span class="icono">üìä</span>Reportes
                </a></li>
            </ul>
            
            <div class="usuario-info">
                <div class="avatar">üë§</div>
                <div class="info">
                    <p id="nombreUsuario">Usuario</p>
                    <small id="tipoUsuario">Empleado</small>
                </div>
                <button onclick="cerrarSesion()" class="btn-salir">üö™</button>
            </div>
        </nav>

        <!-- Contenido principal -->
        <main class="contenido-principal">
            <header class="cabecera">
                <h1 id="tituloSeccion">Dashboard</h1>
                <div class="acciones">
                    <!-- Botones de Nuevo Paquete y Actualizar eliminados -->
                </div>
            </header>

            <!-- Secci√≥n Inicio -->
            <section id="seccion-inicio" class="seccion activa">
                <div class="tarjetas-resumen">
                    <div class="tarjeta">
                        <div class="icono-tarjeta">üì¶</div>
                        <div class="info-tarjeta">
                            <h3 id="totalPaquetes">0</h3>
                            <p>Total Paquetes</p>
                        </div>
                    </div>
                    <div class="tarjeta">
                        <div class="icono-tarjeta">üöõ</div>
                        <div class="info-tarjeta">
                            <h3 id="enTransito">0</h3>
                            <p>En Tr√°nsito</p>
                        </div>
                    </div>
                    <div class="tarjeta">
                        <div class="icono-tarjeta">‚úÖ</div>
                        <div class="info-tarjeta">
                            <h3 id="entregados">0</h3>
                            <p>Entregados</p>
                        </div>
                    </div>
                    <div class="tarjeta">
                        <div class="icono-tarjeta">üí∞</div>
                        <div class="info-tarjeta">
                            <h3 id="ingresos">S/ 0</h3>
                            <p>Ingresos Hoy</p>
                        </div>
                    </div>
                </div>

                <div class="graficos">
                    <div class="grafico-container">
                        <h3>Paquetes por Estado</h3>
                        <canvas id="graficoEstados" width="400" height="200"></canvas>
                    </div>
                    <div class="actividad-reciente">
                        <h3>Actividad Reciente</h3>
                        <div id="listaActividad" class="lista-actividad">
                            <!-- Se llena din√°micamente -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n Paquetes -->
            <section id="seccion-paquetes" class="seccion">
                <div class="filtros">
                    <input type="text" id="buscarPaquete" placeholder="Buscar por c√≥digo o destinatario...">
                    <select id="filtroEstado">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="en_transito">En Tr√°nsito</option>
                        <option value="entregado">Entregado</option>
                        <option value="devuelto">Devuelto</option>
                    </select>
                </div>
                
                <div class="tabla-container">
                    <table id="tablaPaquetes">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Remitente</th>
                                <th>Destinatario</th>
                                <th>Estado</th>
                                <th>Peso</th>
                                <th>Precio</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaPaquetes">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Secci√≥n Rutas -->
            <section id="seccion-rutas" class="seccion">
                <div class="acciones-seccion">
                    <button class="btn btn-primario" onclick="nuevaRuta()">+ Nueva Ruta</button>
                </div>
                <div id="listaRutas" class="lista-rutas">
                    <!-- Se llena din√°micamente -->
                </div>
            </section>

            <!-- Secci√≥n Veh√≠culos -->
            <section id="seccion-vehiculos" class="seccion">
                <div class="acciones-seccion">
                    <button class="btn btn-primario" onclick="nuevoVehiculo()">+ Nuevo Veh√≠culo</button>
                </div>
                <div id="listaVehiculos" class="lista-vehiculos">
                    <!-- Se llena din√°micamente -->
                </div>
            </section>

            <!-- Secci√≥n Reportes -->
            <section id="seccion-reportes" class="seccion">
                <div class="filtros-reporte">
                    <input type="date" id="fechaInicio">
                    <input type="date" id="fechaFin">
                    <button class="btn btn-primario" onclick="generarReporte()">Generar Reporte</button>
                </div>
                <div id="contenidoReporte" class="contenido-reporte">
                    <!-- Se llena din√°micamente -->
                </div>
            </section>
        </main>
    </div>


    <script>
        // Cerrar sesi√≥n
        function cerrarSesion() {
            if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                // Limpiar el almacenamiento local si es necesario
                if (typeof(Storage) !== 'undefined') {
                    localStorage.removeItem('sesion_activa');
                    sessionStorage.clear();
                }
                
                // Realizar la petici√≥n de cierre de sesi√≥n
                fetch('php/cerrar_sesion.php', {
                    method: 'GET',
                    credentials: 'same-origin',
                    headers: {
                        'Cache-Control': 'no-cache, no-store',
                        'Pragma': 'no-cache'
                    }
                })
                .then(response => {
                    // Asegurarse de que la redirecci√≥n ocurra incluso si hay un error en la respuesta
                    if (!response.ok) {
                        throw new Error('Error en la respuesta del servidor');
                    }
                    // Forzar recarga sin cach√©
                    window.location.replace('login.html');
                })
                .catch(error => {
                    console.error('Error al cerrar sesi√≥n:', error);
                    // Redirigir de todas formas
                    window.location.replace('login.html');
                });
            }
        }

        // Otras funciones del dashboard
        function mostrarSeccion(seccion) {
            // Ocultar todas las secciones
            const secciones = document.querySelectorAll('.seccion');
            secciones.forEach(s => s.classList.remove('activa'));
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById('seccion-' + seccion).classList.add('activa');
            
            // Actualizar men√∫ activo
            const menuItems = document.querySelectorAll('.menu a');
            menuItems.forEach(item => item.classList.remove('activo'));
            event.target.classList.add('activo');
            
            // Actualizar t√≠tulo
            const titulos = {
                'inicio': 'Dashboard',
                'paquetes': 'Gesti√≥n de Paquetes',
                'rutas': 'Gesti√≥n de Rutas',
                'vehiculos': 'Gesti√≥n de Veh√≠culos',
                'reportes': 'Reportes'
            };
            document.getElementById('tituloSeccion').textContent = titulos[seccion] || 'Dashboard';
        }

        function cerrarModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function actualizar() {
            location.reload();
        }

        // Prevenir navegaci√≥n hacia atr√°s despu√©s de cerrar sesi√≥n
        window.history.pushState(null, null, window.location.href);
        window.onpopstate = function(event) {
            window.history.pushState(null, null, window.location.href);
        };

        // Verificar sesi√≥n al cargar
        document.addEventListener('DOMContentLoaded', function() {
            fetch('php/verificar_sesion.php')
                .then(response => response.json())
                .then(data => {
                    if (!data.sesion_activa || data.usuario.tipo !== 'asistente') {
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    // Actualizar informaci√≥n del usuario
                    document.getElementById('nombreUsuario').textContent = data.usuario.nombre;
                })
                .catch(error => {
                    console.error('Error:', error);
                    window.location.href = 'login.html';
                });
        });
    </script>
    <script src="js/dashboard.js"></script>
</body>
</html>