<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#007bff">
    <meta name="description" content="Panel de Administraci√≥n HERMES EXPRESS LOGISTIC">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Preload de fuentes cr√≠ticas -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>
    
    <!-- Precargar CSS cr√≠tico -->
    <link rel="stylesheet" href="css/paneladmin.css">
    <link rel="stylesheet" href="css/paneladmin-responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>HERMES - Panel Administrador</title>
</head>
<body>
    <div class="contenedor">
        <!-- Bot√≥n de men√∫ m√≥vil -->
        <button class="menu-movil" id="btnMenuMovil" aria-label="Men√∫">
            <i class="fas fa-bars"></i>
        </button>
        
        <nav class="barra-lateral" id="barraLateral">
            <div class="logo">
                <h2>HERMES EXPRESS LOGISTIC</h2>
            </div>
            
            <ul class="menu">
                <li><a href="javascript:void(0)" class="activo" onclick="mostrarSeccion('dashboard', this)">
                    <span class="icono">üìä</span>Dashboard
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('paquetes', this)">
                    <span class="icono">üì¶</span>Paquetes
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('empleados', this)">
                    <span class="icono">üë•</span>Empleados
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('vehiculos', this)">
                    <span class="icono">üöõ</span>Veh√≠culos
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('rutas', this)">
                    <span class="icono">üó∫Ô∏è</span>Rutas
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('reportes', this)">
                    <span class="icono">üìä</span>Reportes
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('pagos', this)">
                    <span class="icono">üí∞</span>Pagos Empleados
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('configuracion', this)">
                    <span class="icono">‚öôÔ∏è</span>Configuraci√≥n
                </a></li>
                <li><a href="javascript:void(0)" onclick="mostrarSeccion('extraccion', this)">
                    <span class="icono">üì•</span>Extracci√≥n de Datos
                </a></li>
            </ul>
            
            <div class="usuario-info">
                <div class="avatar">üë§</div>
                <div class="info">
                    <p id="nombreUsuario">Administrador</p>
                    <small>Admin</small>
                </div>
                <button onclick="cerrarSesion()" class="btn-salir">üö™</button>
            </div>
        </nav>

        <main class="contenido-principal">
            <header class="cabecera">
                <h1 id="tituloSeccion">Panel de Administraci√≥n</h1>
                <div class="acciones">
                    <!-- Bot√≥n de actualizaci√≥n eliminado -->
                </div>
            </header>

            <section id="seccion-dashboard" class="seccion activa">
                <div class="metricas-principales">
                    <div class="tarjeta-metrica">
                        <div class="icono-metrica">üì¶</div>
                        <div class="info-metrica">
                            <h3 id="totalPaquetes">0</h3>
                            <p>Total Paquetes</p>
                        </div>
                    </div>
                    <div class="tarjeta-metrica">
                        <div class="icono-metrica">üí∞</div>
                        <div class="info-metrica">
                            <h3 id="ingresosMes">$0</h3>
                            <p>Ingresos del Mes</p>
                        </div>
                    </div>
                    <div class="tarjeta-metrica">
                        <div class="icono-metrica">üë•</div>
                        <div class="info-metrica">
                            <h3 id="empleadosActivos">0</h3>
                            <p>Empleados Activos</p>
                        </div>
                    </div>
                    <div class="tarjeta-metrica">
                        <div class="icono-metrica">üöõ</div>
                        <div class="info-metrica">
                            <h3 id="vehiculosOperativos">0</h3>
                            <p>Veh√≠culos Operativos</p>
                        </div>
                    </div>
                </div>

                <div class="graficos-admin">
                    <div class="grafico-ventas">
                        <h3>Ingresos por Mes</h3>
                        <canvas id="graficoVentas" width="600" height="300"></canvas>
                    </div>
                    <div class="actividad-reciente">
                        <h3>Actividad Reciente</h3>
                        <div id="listaActividad" class="lista-actividad">
                        </div>
                    </div>
                </div>
            </section>

            <section id="seccion-paquetes" class="seccion">
                <div class="filtros">
                    <input type="text" id="buscarPaquete" placeholder="Buscar por c√≥digo o destinatario...">
                    <select id="filtroEstado">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="en_transito">En Tr√°nsito</option>
                        <option value="entregado">Entregado</option>
                        <option value="devuelto">Devuelto</option>
                    </select>
                </div>
                
                <div class="tabla-container">
                    <table id="tablaPaquetes">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Remitente</th>
                                <th>Destinatario</th>
                                <th>Estado</th>
                                <th>Peso</th>
                                <th>Precio</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaPaquetes">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="seccion-empleados" class="seccion">
                <div class="controles-empleados">
                    <button class="btn btn-primario" onclick="nuevoEmpleado()">+ Nuevo Empleado</button>
                    <button class="btn btn-secundario" onclick="cargarEmpleados()">üîÑ Actualizar</button>
                </div>
                
                <div class="tabla-container">
                    <table id="tablaEmpleados">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Usuario</th>
                                <th>Email</th>
                                <th>Tipo</th>
                                <th>Estado</th>
                                <th>Fecha Registro</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaEmpleados">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="seccion-vehiculos" class="seccion">
                <div class="controles-vehiculos">
                    <button class="btn btn-primario" onclick="nuevoVehiculo()">+ Nuevo Veh√≠culo</button>
                    <button class="btn btn-secundario" onclick="cargarVehiculos()">üîÑ Actualizar</button>
                </div>
                
                <div class="tabla-container">
                    <table id="tablaVehiculos">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Placa</th>
                                <th>Marca</th>
                                <th>Modelo</th>
                                <th>Capacidad</th>
                                <th>Estado</th>
                                <th>Empleado Asignado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaVehiculos">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="seccion-rutas" class="seccion">
                <div class="controles-rutas">
                    <button class="btn btn-primario" onclick="nuevaRuta()">+ Nueva Ruta</button>
                    <button class="btn btn-secundario" onclick="cargarRutas()">üîÑ Actualizar</button>
                </div>
                
                <div class="tabla-container">
                    <table id="tablaRutas">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Origen</th>
                                <th>Destino</th>
                                <th>Distancia (km)</th>
                                <th>Tiempo Estimado (min)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cuerpoTablaRutas">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="seccion-reportes" class="seccion">
                <div class="generador-reportes">
                    <h3>Generar Reportes</h3>
                    <div class="opciones-reporte">
                        <div class="form-grupo">
                            <label>Tipo de Reporte:</label>
                            <select id="tipoReporte">
                                <option value="paquetes">Reporte de Paquetes</option>
                                <option value="ventas">Reporte de Ventas</option>
                                <option value="empleados">Reporte de Empleados</option>
                                <option value="vehiculos">Reporte de Veh√≠culos</option>
                                <option value="empleados_paquetes">Empleados + Paquetes Entregados</option>
                                <option value="rutas_paquetes">Rutas + Paquetes por Ruta</option>
                                <option value="vehiculos_entregas">Veh√≠culos + Entregas Realizadas</option>
                            </select>
                        </div>
                        <div class="form-grupo">
                            <label>Fecha Inicio:</label>
                            <input type="date" id="reporteFechaInicio">
                        </div>
                        <div class="form-grupo">
                            <label>Fecha Fin:</label>
                            <input type="date" id="reporteFechaFin">
                        </div>
                        <div class="form-grupo">
                            <label>Formato de Descarga:</label>
                            <select id="formatoDescarga">
                                <option value="ver">Solo Ver en Pantalla</option>
                                <option value="excel">Descargar Excel (.xlsx)</option>
                                <option value="pdf">Descargar PDF</option>
                            </select>
                        </div>
                        <button class="btn btn-primario" onclick="generarReporte()">Generar Reporte</button>
                    </div>
                </div>
                
                <div id="vistaReporte" class="vista-reporte">
                    <div id="contenidoReporte">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
            </section>

            <section id="seccion-pagos" class="seccion">
                <div class="seccion-header">
                    <h2>Gesti√≥n de Pagos a Empleados</h2>
                    <div class="acciones">
                        <button class="btn btn-primario" onclick="calcularPagos()">üßÆ Calcular Pagos</button>
                        <button class="btn btn-secundario" onclick="configurarTarifas()">‚öôÔ∏è Configurar Tarifas</button>
                        <button class="btn btn-exito" onclick="exportarPagos()">üìÑ Exportar</button>
                    </div>
                </div>

                <!-- Filtros de per√≠odo -->
                <div class="filtros-pago">
                    <div class="form-group">
                        <label>Per√≠odo Inicio</label>
                        <input type="date" id="fechaInicioPago" value="">
                    </div>
                    <div class="form-group">
                        <label>Per√≠odo Fin</label>
                        <input type="date" id="fechaFinPago" value="">
                    </div>
                    <div class="form-group">
                        <label>Empleado</label>
                        <select id="filtroEmpleadoPago">
                            <option value="">Todos los empleados</option>
                        </select>
                    </div>
                    <button class="btn btn-primario" onclick="filtrarPagos()">üîç Filtrar</button>
                </div>

                <!-- Tarifas por tipo de ruta -->
                <div class="tarifas-container">
                    <h3>Tarifas por Tipo de Ruta</h3>
                    <div class="tarifas-grid" id="tarifasGrid">
                        <!-- Se llenan din√°micamente -->
                    </div>
                </div>

                <!-- Resumen de pagos -->
                <div class="pagos-resumen">
                    <div class="pago-card">
                        <h4>Total a Pagar</h4>
                        <p class="monto-total" id="totalPagar">$0</p>
                    </div>
                    <div class="pago-card">
                        <h4>Empleados</h4>
                        <p class="numero" id="totalEmpleados">0</p>
                    </div>
                    <div class="pago-card">
                        <h4>Paquetes Entregados</h4>
                        <p class="numero" id="totalEntregados">0</p>
                    </div>
                    <div class="pago-card">
                        <h4>Paquetes Devueltos</h4>
                        <p class="numero" id="totalDevueltos">0</p>
                    </div>
                </div>

                <!-- Lista de pagos por empleado -->
                <div class="pagos-empleados">
                    <h3>Pagos por Empleado</h3>
                    <div class="tabla-container">
                        <table class="tabla">
                            <thead>
                                <tr>
                                    <th>Empleado</th>
                                    <th>Entregados</th>
                                    <th>Devueltos</th>
                                    <th>Urbano</th>
                                    <th>Distrital</th>
                                    <th>Interprovincial</th>
                                    <th>Interurbano</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaPagos">
                                </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="seccion-configuracion" class="seccion">
                <div class="seccion-header">
                    <h2>Configuraci√≥n del Sistema</h2>
                    <div class="acciones">
                        <button class="btn btn-primario" onclick="guardarConfigSistema()">üíæ Guardar</button>
                    </div>
                </div>

                <div class="config-grid">
                    <div class="config-card">
                        <h3>Informaci√≥n de la Empresa</h3>
                        <form id="formEmpresa">
                            <div class="form-group">
                                <label>Nombre de la Empresa</label>
                                <input type="text" value="Hermes Express" required>
                            </div>
                            <div class="form-group">
                                <label>Direcci√≥n</label>
                                <input type="text" value="Calle Principal #123" required>
                            </div>
                            <div class="form-group">
                                <label>Tel√©fono</label>
                        </div>
                        <div class="config-item">
                            <label>
                                <input type="checkbox"> Modo Mantenimiento
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <div id="modalTarifas" class="modal">
                <div class="modal-contenido">
                    <div class="modal-header">
                        <h3>Configurar Tarifas por Ruta</h3>
                        <span class="cerrar" onclick="cerrarModal('modalTarifas')">&times;</span>
                    </div>
                    <form id="formTarifas">
                        <div class="form-group">
                            <label>Tipo de Ruta</label>
                            <select id="tipoRutaTarifa" required>
                                <option value="urbano">Urbano</option>
                                <option value="distrital">Distrital</option>
                                <option value="interprovincial">Interprovincial</option>
                                <option value="interurbano">Interurbano</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Tarifa Base ($)</label>
                            <input type="number" id="tarifaBase" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Tarifa por Kg ($)</label>
                            <input type="number" id="tarifaPorKg" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Comisi√≥n Empleado (%)</label>
                            <input type="number" id="comisionEmpleado" step="0.01" min="0" max="100" required>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="descripcionTarifa" rows="3"></textarea>
                        </div>
                        <div class="modal-acciones">
                            <button type="button" class="btn btn-secundario" onclick="cerrarModal('modalTarifas')">Cancelar</button>
                            <button type="submit" class="btn btn-primario">Guardar Tarifa</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="modalEditarCantidades" class="modal">
                <div class="modal-contenido">
                    <div class="modal-header">
                        <h3>Editar Cantidades por Zona</h3>
                        <span class="cerrar" onclick="cerrarModal('modalEditarCantidades')">&times;</span>
                    </div>
                    <div class="empleado-info">
                        <h4 id="empleadoEditando">Empleado: </h4>
                        <p>Per√≠odo: <span id="periodoEditando"></span></p>
                    </div>
                    
                    <div class="zonas-grid">
                        <div class="zona-card">
                            <h5>üèôÔ∏è Urbano</h5>
                            <div class="cantidad-controls">
                                <label>Entregados:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('urbano', 'entregados', -1)">-</button>
                                    <input type="number" id="urbano-entregados" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('urbano', 'entregados', 1)">+</button>
                                </div>
                            </div>
                            <div class="cantidad-controls">
                                <label>Devueltos:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('urbano', 'devueltos', -1)">-</button>
                                    <input type="number" id="urbano-devueltos" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('urbano', 'devueltos', 1)">+</button>
                                </div>
                            </div>
                            <div class="zona-total">Total: $<span id="urbano-total">0</span></div>
                        </div>

                        <div class="zona-card">
                            <h5>üèòÔ∏è Distrital</h5>
                            <div class="cantidad-controls">
                                <label>Entregados:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('distrital', 'entregados', -1)">-</button>
                                    <input type="number" id="distrital-entregados" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('distrital', 'entregados', 1)">+</button>
                                </div>
                            </div>
                            <div class="cantidad-controls">
                                <label>Devueltos:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('distrital', 'devueltos', -1)">-</button>
                                    <input type="number" id="distrital-devueltos" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('distrital', 'devueltos', 1)">+</button>
                                </div>
                            </div>
                            <div class="zona-total">Total: $<span id="distrital-total">0</span></div>
                        </div>

                        <div class="zona-card">
                            <h5>üåç Interprovincial</h5>
                            <div class="cantidad-controls">
                                <label>Entregados:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('interprovincial', 'entregados', -1)">-</button>
                                    <input type="number" id="interprovincial-entregados" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('interprovincial', 'entregados', 1)">+</button>
                                </div>
                            </div>
                            <div class="cantidad-controls">
                                <label>Devueltos:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('interprovincial', 'devueltos', -1)">-</button>
                                    <input type="number" id="interprovincial-devueltos" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('interprovincial', 'devueltos', 1)">+</button>
                                </div>
                            </div>
                            <div class="zona-total">Total: $<span id="interprovincial-total">0</span></div>
                        </div>

                        <div class="zona-card">
                            <h5>üöó Interurbano</h5>
                            <div class="cantidad-controls">
                                <label>Entregados:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('interurbano', 'entregados', -1)">-</button>
                                    <input type="number" id="interurbano-entregados" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('interurbano', 'entregados', 1)">+</button>
                                </div>
                            </div>
                            <div class="cantidad-controls">
                                <label>Devueltos:</label>
                                <div class="input-group">
                                    <button type="button" onclick="ajustarCantidad('interurbano', 'devueltos', -1)">-</button>
                                    <input type="number" id="interurbano-devueltos" min="0" value="0">
                                    <button type="button" onclick="ajustarCantidad('interurbano', 'devueltos', 1)">+</button>
                                </div>
                            </div>
                            <div class="zona-total">Total: $<span id="interurbano-total">0</span></div>
                        </div>
                    </div>

                    <div class="resumen-edicion">
                        <div class="total-general">
                            <h4>Total General: $<span id="totalGeneralEdicion">0</span></h4>
                        </div>
                    </div>

                    <div class="modal-acciones">
                        <button type="button" class="btn btn-secundario" onclick="cerrarModal('modalEditarCantidades')">Cancelar</button>
                        <button type="button" class="btn btn-primario" onclick="guardarCantidades()">Guardar Cambios</button>
                    </div>
                </div>
            </div>

            <div id="modalVehiculo" class="modal">
                <div class="modal-contenido">
                    <span class="cerrar" onclick="cerrarModal('modalVehiculo')">&times;</span>
                    <h2>Nuevo Veh√≠culo</h2>
                    <form id="formVehiculo" onsubmit="guardarVehiculo(event)">
                        <div class="form-grupo">
                            <label>Placa:</label>
                            <input type="text" id="placaVehiculo" required>
                        </div>
                        <div class="form-grupo">
                            <label>Marca:</label>
                            <input type="text" id="marcaVehiculo" required>
                        </div>
                        <div class="form-grupo">
                            <label>Modelo:</label>
                            <input type="text" id="modeloVehiculo" required>
                        </div>
                        <div class="form-grupo">
                            <label>Capacidad (kg):</label>
                            <input type="number" id="capacidadVehiculo" step="0.1" required>
                        </div>
                        <div class="form-grupo">
                            <label>Estado:</label>
                            <select id="estadoVehiculo" required>
                                <option value="disponible">Disponible</option>
                                <option value="en_uso">En Uso</option>
                                <option value="mantenimiento">Mantenimiento</option>
                            </select>
                        </div>
                        <div class="form-acciones">
                            <button type="submit" class="btn btn-primario">Guardar</button>
                            <button type="button" class="btn btn-secundario" onclick="cerrarModal('modalVehiculo')">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="modalRuta" class="modal">
                <div class="modal-contenido">
                    <span class="cerrar" onclick="cerrarModal('modalRuta')">&times;</span>
                    <h2>Nueva Ruta</h2>
                    <form id="formRuta" onsubmit="guardarRuta(event)">
                        <div class="form-grupo">
                            <label>Nombre de la Ruta:</label>
                            <input type="text" id="nombreRuta" required>
                        </div>
                        <div class="form-grupo">
                            <label>Origen:</label>
                            <input type="text" id="origenRuta" required>
                        </div>
                        <div class="form-grupo">
                            <label>Destino:</label>
                            <input type="text" id="destinoRuta" required>
                        </div>
                        <div class="form-grupo">
                            <label>Distancia (km):</label>
                            <input type="number" id="distanciaRuta" step="0.1" required>
                        </div>
                        <div class="form-grupo">
                            <label>Tiempo Estimado (minutos):</label>
                            <input type="number" id="tiempoRuta" required>
                        </div>
                        <div class="form-acciones">
                            <button type="submit" class="btn btn-primario">Guardar</button>
                            <button type="button" class="btn btn-secundario" onclick="cerrarModal('modalRuta')">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="modalEmpleado" class="modal">
                <div class="modal-contenido">
                    <span class="cerrar" onclick="cerrarModal('modalEmpleado')">&times;</span>
                    <h2>Nuevo Empleado</h2>
                    <form id="formEmpleado" onsubmit="guardarEmpleado(event)">
                        <div class="form-grupo">
                            <label>Nombre:</label>
                            <input type="text" id="nombreEmpleado" required>
                        </div>
                        <div class="form-grupo">
                            <label>Usuario:</label>
                            <input type="text" id="usuarioEmpleado" required>
                        </div>
                        <div class="form-grupo">
                            <label>Email:</label>
                            <input type="email" id="emailEmpleado" required>
                        </div>
                        <div class="form-grupo">
                            <label>Contrase√±a:</label>
                            <input type="password" id="claveEmpleado" required>
                        </div>
                        <div class="form-grupo">
                            <label>Tipo:</label>
                            <select id="tipoEmpleado" required>
                                <option value="empleado">Empleado</option>
                                <option value="asistente">Asistente</option>
                            </select>
                        </div>
                        <div class="form-acciones">
                            <button type="submit" class="btn btn-primario">Guardar</button>
                            <button type="button" class="btn btn-secundario" onclick="cerrarModal('modalEmpleado')">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

        </main>
    </div>

    <section id="seccion-extraccion" class="seccion">
        <div class="seccion-header">
            <h2>Extracci√≥n de Datos de SAVAR</h2>
            <p>Extraiga informaci√≥n de SAVAR y gu√°rdela en la base de datos local.</p>
        </div>

        <div class="extraccion-contenedor">
            <div class="formulario-extraccion">
                <div class="form-grupo">
                    <label for="fechaInicio">Fecha de Inicio:</label>
                    <input type="date" id="fechaInicio" class="form-control">
                </div>
                
                <div class="form-grupo">
                    <label for="fechaFin">Fecha de Fin:</label>
                    <input type="date" id="fechaFin" class="form-control">
                </div>
                
                <div class="form-grupo">
                    <label for="usuarioSavar">Usuario SAVAR:</label>
                    <input type="text" id="usuarioSavar" class="form-control" placeholder="Ingrese su usuario SAVAR">
                </div>
                
                <div class="form-grupo">
                    <label for="contrasenaSavar">Contrase√±a SAVAR:</label>
                    <input type="password" id="contrasenaSavar" class="form-control" placeholder="Ingrese su contrase√±a SAVAR">
                </div>
                
                <div class="acciones-extraccion">
                    <button type="button" class="btn btn-primario" onclick="ejecutarExtraccion()">
                        <span class="icono">‚ñ∂Ô∏è</span> Ejecutar Extracci√≥n
                    </button>
                    <div class="estado-extraccion" id="estadoExtraccion">
                        <div class="spinner-border text-primary spinner-border-sm d-none" role="status" id="spinnerExtraccion">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <span id="mensajeEstado">Listo para ejecutar</span>
                    </div>
                </div>
            </div>
            
            <div class="resultados-extraccion" id="resultadosExtraccion">
                <h3>Resultados de la Extracci√≥n</h3>
                <div class="log-extraccion" id="logExtraccion">
                    <!-- Aqu√≠ se mostrar√° el progreso de la extracci√≥n -->
                </div>
            </div>
        </div>
    </section>

    <script>
        // Funci√≥n para cerrar sesi√≥n - definida globalmente
        function cerrarSesion() {
            if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                // Limpiar el almacenamiento local si es necesario
                if (typeof(Storage) !== 'undefined') {
                    localStorage.removeItem('sesion_activa');
                    sessionStorage.clear();
                }
                
                // Realizar la petici√≥n de cierre de sesi√≥n
                fetch('php/cerrar_sesion.php', {
                    method: 'GET',
                    credentials: 'same-origin',
                    headers: {
                        'Cache-Control': 'no-cache, no-store',
                        'Pragma': 'no-cache'
                    }
                })
                .then(response => {
                    // Asegurarse de que la redirecci√≥n ocurra incluso si hay un error en la respuesta
                    if (!response.ok) {
                        throw new Error('Error en la respuesta del servidor');
                    }
                    // Forzar recarga sin cach√©
                    window.location.replace('login.html');
                })
                .catch(error => {
                    console.error('Error al cerrar sesi√≥n:', error);
                    // Redirigir de todas formas
                    window.location.replace('login.html');
                });
            }
        }

        // Funci√≥n para abrir modal
        function abrirModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        // Funci√≥n para cerrar modal
        function cerrarModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Limpiar formularios
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
        }

        // Funci√≥n para actualizar p√°gina
        function actualizar() {
            location.reload();
        }
        
        // Funci√≥n para nuevos empleados, veh√≠culos, rutas
        function nuevoEmpleado() {
            document.getElementById('modalEmpleado').style.display = 'block';
        }
        
        function nuevoVehiculo() {
            abrirModal('modalVehiculo');
        }
        
        function nuevaRuta() {
            abrirModal('modalRuta');
        }
        
        // Funciones para guardar nuevos registros
        function guardarVehiculo() {
            const formData = new FormData();
            formData.append('accion', 'crear_vehiculo');
            formData.append('placa', document.getElementById('placa').value);
            formData.append('marca', document.getElementById('marca').value);
            formData.append('modelo', document.getElementById('modelo').value);
            formData.append('anio', document.getElementById('anio').value);
            formData.append('capacidad', document.getElementById('capacidad').value);
            formData.append('estado', document.getElementById('estado').value);
            
            const empleadoId = document.getElementById('empleadoId').value;
            if (empleadoId) {
                formData.append('empleado_id', empleadoId);
            }
            
            fetch('php/admin.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.exito) {
                    alert('Veh√≠culo guardado exitosamente');
                    document.getElementById('formVehiculo').reset();
                    cerrarModal('modalVehiculo');
                    cargarVehiculos();
                } else {
                    alert('Error: ' + (data.mensaje || 'Error desconocido'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al guardar veh√≠culo. Verifica la consola para m√°s detalles.');
            });
        }
        
        function guardarRuta(event) {
            event.preventDefault();
            
            const formData = new FormData();
            formData.append('accion', 'nueva_ruta');
            formData.append('nombre', document.getElementById('nombreRuta').value);
            formData.append('origen', document.getElementById('origenRuta').value);
            formData.append('destino', document.getElementById('destinoRuta').value);
            formData.append('distancia', document.getElementById('distanciaRuta').value);
            formData.append('tiempo_estimado', document.getElementById('tiempoRuta').value);
            
            fetch('php/admin.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.exito) {
                    alert('Ruta creada exitosamente');
                    cerrarModal('modalRuta');
                    cargarRutas();
                } else {
                    alert('Error: ' + data.mensaje);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al crear ruta');
            });
        }
        
        function guardarEmpleado(event) {
            event.preventDefault();
            
            // Obtener referencias a los elementos del formulario
            const form = document.getElementById('formEmpleado');
            const formData = new FormData(form);
            formData.append('accion', 'nuevo_empleado');
            
            // Validar campos obligatorios
            const requiredFields = ['nombre', 'usuario', 'email', 'clave', 'tipo'];
            let isValid = true;
            
            requiredFields.forEach(field => {
                const value = formData.get(field);
                if (!value || value.trim() === '') {
                    alert(`El campo ${field} es obligatorio`);
                    isValid = false;
                    return;
                }
            });
            
            if (!isValid) return;
            
            // Mostrar indicador de carga
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
            
            // Enviar datos al servidor
            fetch('php/admin.php', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la respuesta del servidor');
                }
                return response.json();
            })
            .then(data => {
                if (data.exito) {
                    // Mostrar mensaje de √©xito
                    const successAlert = document.createElement('div');
                    successAlert.className = 'alert alert-success';
                    successAlert.role = 'alert';
                    successAlert.innerHTML = `
                        <i class="fas fa-check-circle"></i> 
                        ${data.mensaje || 'Empleado creado exitosamente'}
                    `;
                    
                    // Insertar el mensaje antes del formulario
                    form.parentNode.insertBefore(successAlert, form);
                    
                    // Limpiar el formulario
                    form.reset();
                    
                    // Cerrar el modal despu√©s de 1.5 segundos
                    setTimeout(() => {
                        cerrarModal('modalEmpleado');
                        cargarEmpleados();
                        
                        // Eliminar el mensaje de √©xito despu√©s de cerrar el modal
                        if (successAlert.parentNode) {
                            successAlert.parentNode.removeChild(successAlert);
                        }
                    }, 1500);
                    
                } else {
                    // Mostrar mensaje de error
                    throw new Error(data.mensaje || 'Error desconocido al crear empleado');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                
                // Mostrar mensaje de error al usuario
                const errorAlert = document.createElement('div');
                errorAlert.className = 'alert alert-danger';
                errorAlert.role = 'alert';
                errorAlert.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i> 
                    ${error.message || 'Error al crear empleado. Por favor, int√©ntalo de nuevo.'}
                `;
                
                // Insertar el mensaje antes del formulario
                form.parentNode.insertBefore(errorAlert, form);
                
                // Eliminar el mensaje despu√©s de 5 segundos
                setTimeout(() => {
                    if (errorAlert.parentNode) {
                        errorAlert.parentNode.removeChild(errorAlert);
                    }
                }, 5000);
            })
            .finally(() => {
                // Restaurar el bot√≥n
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            });
        }
        
        function generarReporte() {
            const tipo = document.getElementById('tipoReporte').value;
            const fechaInicio = document.getElementById('reporteFechaInicio').value;
            const fechaFin = document.getElementById('reporteFechaFin').value;
            const formato = document.getElementById('formatoDescarga').value;
            
            const formData = new FormData();
            formData.append('accion', 'generar_reporte');
            formData.append('tipo', tipo);
            formData.append('fecha_inicio', fechaInicio);
            formData.append('fecha_fin', fechaFin);
            formData.append('formato', formato);
            
            if (formato === 'ver') {
                // Mostrar en pantalla
                fetch('php/admin.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        mostrarReporte(data.datos, tipo);
                    } else {
                        alert('Error al generar reporte: ' + data.mensaje);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al generar reporte');
                });
            } else {
                // Descargar archivo
                const url = 'php/admin.php?' + new URLSearchParams({
                    accion: 'generar_reporte',
                    tipo: tipo,
                    fecha_inicio: fechaInicio,
                    fecha_fin: fechaFin,
                    formato: formato
                });
                
                // Crear enlace temporal para descarga
                const link = document.createElement('a');
                link.href = url;
                link.download = `reporte_${tipo}_${new Date().toISOString().split('T')[0]}.${formato === 'excel' ? 'xlsx' : 'pdf'}`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
        
        function mostrarReporte(datos, tipo) {
            const contenedor = document.getElementById('contenidoReporte');
            let html = `<h4>Reporte de ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</h4>`;
            
            if (datos.length === 0) {
                html += '<p>No hay datos para mostrar en el per√≠odo seleccionado.</p>';
            } else {
                html += '<table class="tabla-reporte"><thead><tr>';
                
                // Headers seg√∫n tipo de reporte
                if (tipo === 'paquetes') {
                    html += '<th>C√≥digo</th><th>Remitente</th><th>Destinatario</th><th>Estado</th><th>Precio</th><th>Fecha</th>';
                } else if (tipo === 'ventas') {
                    html += '<th>Fecha</th><th>Total Paquetes</th><th>Ingresos</th>';
                } else if (tipo === 'empleados') {
                    html += '<th>Nombre</th><th>Usuario</th><th>Tipo</th><th>Estado</th><th>Fecha Registro</th>';
                } else if (tipo === 'vehiculos') {
                    html += '<th>Placa</th><th>Marca</th><th>Modelo</th><th>Estado</th><th>Empleado</th>';
                }
                
                html += '</tr></thead><tbody>';
                
                datos.forEach(item => {
                    html += '<tr>';
                    if (tipo === 'paquetes') {
                        html += `<td>${item.codigo}</td><td>${item.remitente}</td><td>${item.destinatario}</td><td>${item.estado}</td><td>$${item.precio}</td><td>${new Date(item.fecha_envio).toLocaleDateString()}</td>`;
                    } else if (tipo === 'ventas') {
                        html += `<td>${item.fecha}</td><td>${item.total_paquetes}</td><td>$${item.ingresos}</td>`;
                    } else if (tipo === 'empleados') {
                        html += `<td>${item.nombre}</td><td>${item.usuario}</td><td>${item.tipo}</td><td>${item.activo ? 'Activo' : 'Inactivo'}</td><td>${new Date(item.fecha_registro).toLocaleDateString()}</td>`;
                    } else if (tipo === 'vehiculos') {
                        html += `<td>${item.placa}</td><td>${item.marca}</td><td>${item.modelo}</td><td>${item.estado}</td><td>${item.empleado_nombre || 'Sin asignar'}</td>`;
                    }
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
            }
            
            contenedor.innerHTML = html;
        }
        
        function calcularPagos() {
            alert('Funci√≥n de calcular pagos - Por implementar');
        }
        
        function configurarTarifas() {
            alert('Funci√≥n de configurar tarifas - Por implementar');
        }
        
        function exportarPagos() {
            alert('Funci√≥n de exportar pagos - Por implementar');
        }
        
        // Funciones para cargar datos de empleados, veh√≠culos y rutas
        function cargarEmpleados() {
            fetch('php/admin.php?accion=empleados')
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        mostrarEmpleados(data.datos);
                    } else {
                        console.error('Error al cargar empleados:', data.mensaje);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        function mostrarEmpleados(empleados) {
            const tbody = document.getElementById('cuerpoTablaEmpleados');
            tbody.innerHTML = '';
            
            empleados.forEach(empleado => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${empleado.id}</td>
                    <td>${empleado.nombre}</td>
                    <td>${empleado.usuario}</td>
                    <td>${empleado.email || 'N/A'}</td>
                    <td>${empleado.tipo}</td>
                    <td><span class="estado estado-${empleado.activo ? 'activo' : 'inactivo'}">${empleado.activo ? 'Activo' : 'Inactivo'}</span></td>
                    <td>${new Date(empleado.fecha_registro).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-pequeno btn-secundario" onclick="eliminarEmpleado(${empleado.id})">Eliminar</button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }
        
        function cargarVehiculos() {
            fetch('php/admin.php?accion=vehiculos')
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        mostrarVehiculos(data.datos);
                    } else {
                        console.error('Error al cargar veh√≠culos:', data.mensaje);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        function mostrarVehiculos(vehiculos) {
            const tbody = document.getElementById('cuerpoTablaVehiculos');
            tbody.innerHTML = '';
            
            if (!vehiculos || !Array.isArray(vehiculos)) {
                console.error('Error: Los datos de veh√≠culos no son v√°lidos', vehiculos);
                return;
            }
            
            if (vehiculos.length === 0) {
                const fila = document.createElement('tr');
                fila.innerHTML = '<td colspan="8" class="texto-centrado">No hay veh√≠culos registrados</td>';
                tbody.appendChild(fila);
                return;
            }
            
            vehiculos.forEach(vehiculo => {
                try {
                    const fila = document.createElement('tr');
                    const estadoClase = (vehiculo.estado || '').toLowerCase().replace(/ /g, '-');
                    
                    fila.innerHTML = `
                        <td>${vehiculo.id || ''}</td>
                        <td>${vehiculo.placa || ''}</td>
                        <td>${vehiculo.marca || ''}</td>
                        <td>${vehiculo.modelo || ''}</td>
                        <td>${vehiculo.capacidad ? parseFloat(vehiculo.capacidad).toFixed(2) + ' kg' : '0.00 kg'}</td>
                        <td>
                            <span class="estado estado-${estadoClase}">
                                ${vehiculo.estado_mostrar || vehiculo.estado || 'Desconocido'}
                            </span>
                        </td>
                        <td>${vehiculo.empleado_nombre || 'Sin asignar'}</td>
                        <td>
                            <button class="btn btn-pequeno btn-secundario" 
                                    onclick="eliminarVehiculo(${vehiculo.id})"
                                    ${vehiculo.estado === 'en_ruta' ? 'disabled' : ''}>
                                Eliminar
                            </button>
                        </td>
                    `;
                    tbody.appendChild(fila);
                } catch (error) {
                    console.error('Error al mostrar veh√≠culo:', error, vehiculo);
                }
            });
        }
        
        function cargarRutas() {
            fetch('php/admin.php?accion=rutas')
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        mostrarRutas(data.datos);
                    } else {
                        console.error('Error al cargar rutas:', data.mensaje);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        function mostrarRutas(rutas) {
            const tbody = document.getElementById('cuerpoTablaRutas');
            tbody.innerHTML = '';
            
            rutas.forEach(ruta => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${ruta.id}</td>
                    <td>${ruta.nombre}</td>
                    <td>${ruta.origen}</td>
                    <td>${ruta.destino}</td>
                    <td>${ruta.distancia}</td>
                    <td>${ruta.tiempo_estimado}</td>
                    <td>
                        <button class="btn btn-pequeno btn-secundario" onclick="eliminarRuta(${ruta.id})">Eliminar</button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }
        
        // Funciones para eliminar registros
        function eliminarEmpleado(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este empleado?')) {
                const formData = new FormData();
                formData.append('accion', 'eliminar_empleado');
                formData.append('id', id);
                
                fetch('php/admin.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        alert('Empleado eliminado exitosamente');
                        cargarEmpleados();
                    } else {
                        alert('Error al eliminar empleado: ' + data.mensaje);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al eliminar empleado');
                });
            }
        }
        
        function eliminarVehiculo(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este veh√≠culo?')) {
                const formData = new FormData();
                formData.append('accion', 'eliminar_vehiculo');
                formData.append('id', id);
                
                fetch('php/admin.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        alert('Veh√≠culo eliminado exitosamente');
                        cargarVehiculos();
                    } else {
                        alert('Error al eliminar veh√≠culo: ' + data.mensaje);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al eliminar veh√≠culo');
                });
            }
        }
        
        function eliminarRuta(id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta ruta?')) {
                const formData = new FormData();
                formData.append('accion', 'eliminar_ruta');
                formData.append('id', id);
                
                fetch('php/admin.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.exito) {
                        alert('Ruta eliminada exitosamente');
                        cargarRutas();
                    } else {
                        alert('Error al eliminar ruta: ' + data.mensaje);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al eliminar ruta');
                });
            }
        }
        
        // Funci√≥n para mostrar secciones
        function mostrarSeccion(seccion, elemento) {
            // Prevenir comportamiento por defecto del enlace
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // No hacer nada si ya estamos en esa secci√≥n
            const seccionActual = document.querySelector('.seccion.activa');
            if (seccionActual && seccionActual.id === 'seccion-' + seccion) {
                return false;
            }
            
            // Ocultar todas las secciones
            const secciones = document.querySelectorAll('.seccion');
            secciones.forEach(s => s.classList.remove('activa'));
            
            // Mostrar la secci√≥n seleccionada
            const seccionElemento = document.getElementById('seccion-' + seccion);
            if (seccionElemento) {
                seccionElemento.classList.add('activa');
            }
            
            // Actualizar men√∫ activo
            const menuItems = document.querySelectorAll('.menu a');
            menuItems.forEach(item => item.classList.remove('activo'));
            
            // Agregar clase activa al elemento clickeado
            if (elemento) {
                elemento.classList.add('activo');
            }
            
            // Actualizar t√≠tulo
            const titulos = {
                'dashboard': 'Panel de Administraci√≥n',
                'empleados': 'Gesti√≥n de Empleados',
                'vehiculos': 'Gesti√≥n de Veh√≠culos',
                'rutas': 'Gesti√≥n de Rutas',
                'reportes': 'Reportes',
                'pagos': 'Pagos Empleados',
                'configuracion': 'Configuraci√≥n'
            };
            document.getElementById('tituloSeccion').textContent = titulos[seccion] || 'Panel de Administraci√≥n';
            
            return false;
        }

        // Cerrar modales al hacer clic fuera de ellos
        window.onclick = function(event) {
            const modales = document.querySelectorAll('.modal');
            modales.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // C√≥digo para el men√∫ m√≥vil
        document.addEventListener('DOMContentLoaded', function() {
            const btnMenu = document.getElementById('btnMenuMovil');
            const barraLateral = document.getElementById('barraLateral');
            const contenidoPrincipal = document.querySelector('.contenido-principal');
            let menuAbierto = false;

            function toggleMenu() {
                menuAbierto = !menuAbierto;
                barraLateral.classList.toggle('activa', menuAbierto);
                contenidoPrincipal.classList.toggle('desplazado', menuAbierto);
                document.body.style.overflow = menuAbierto ? 'hidden' : '';
                
                // Cambiar √≠cono
                const icono = btnMenu.querySelector('i');
                if (menuAbierto) {
                    icono.classList.remove('fa-bars');
                    icono.classList.add('fa-times');
                } else {
                    icono.classList.remove('fa-times');
                    icono.classList.add('fa-bars');
                }
            }

            // Evento para el bot√≥n del men√∫
            if (btnMenu) {
                btnMenu.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleMenu();
                });
            }

            // Cerrar men√∫ al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (menuAbierto && !barraLateral.contains(e.target) && e.target !== btnMenu) {
                    toggleMenu();
                }
            });

            // Cerrar men√∫ al redimensionar la ventana
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    if (window.innerWidth > 992 && menuAbierto) {
                        toggleMenu();
                    }
                }, 250);
            });

            // Prevenir navegaci√≥n hacia atr√°s despu√©s de cerrar sesi√≥n
            window.history.pushState(null, null, window.location.href);
            window.onpopstate = function(event) {
                window.history.pushState(null, null, window.location.href);
            };

            // Verificar sesi√≥n al cargar la p√°gina
            fetch('php/verificar_sesion.php')
                .then(response => response.json())
                .then(data => {
                    if (!data.sesion_activa || data.usuario.tipo !== 'admin') {
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    // Actualizar informaci√≥n del usuario
                    document.getElementById('nombreUsuario').textContent = data.usuario.nombre;
                    
                    // Cargar todos los datos al iniciar
                    cargarEmpleados();
                    cargarVehiculos();
                    cargarRutas();
                })
                .catch(error => {
                    console.error('Error:', error);
                    window.location.href = 'login.html';
                });
        });
    </script>
</body>
</html>